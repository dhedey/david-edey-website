---
import { getCollection } from 'astro:content';
import SimpleContentLayout from '@/layouts/SimpleContentLayout.astro';
import BlogPostList from '@/components/BlogPostList.astro';

export async function getStaticPaths() {
    const posts = await getCollection('blog');
    const tags = new Set<string>();
    for (const post of posts) {
        if (post.data.tags) {
            for (const tag of post.data.tags) {
                tags.add(tag);
            }
        }
    }
    return Array.from(tags).map(tag => ({
        params: { tag },
    }));
}

const { tag } = Astro.params;
const posts = await getCollection('blog');
const filteredPosts = posts.filter(post => post.data.tags?.includes(tag));

if (!filteredPosts.length) {
    throw new Error(`No blog posts found for tag: ${tag}`);
}

const upperTag = tag[0].toUpperCase() + tag.slice(1);
---

<SimpleContentLayout headTitle={`Tag | ${upperTag}`} title={`Blog Posts | ${tag}`}>
    <BlogPostList posts={filteredPosts} />
</SimpleContentLayout>
